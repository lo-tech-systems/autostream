# --- Captive Portal Configuration
#
# This file is part of autostream and enables a simplified WiFi setup
# experience.
#
# Copyright (c) 2025 Lo-tech Systems Limited. All rights reserved.
#

# Only listen on the AP interface
interface=wlan0
bind-interfaces
except-interface=lo

# DHCP range (change to match your AP subnet)
# Example: gateway 192.168.4.1/24, hand out .50-.200
dhcp-range=192.168.4.50,192.168.4.200,255.255.255.0,12h

# Default gateway option (must be your AP/gateway IP)
dhcp-option=option:router,192.168.4.1

# DNS server option: point clients at this box (same as gateway)
dhcp-option=option:dns-server,192.168.4.1

# RFC 8910 Captive Portal API (iOS / macOS / modern clients)
# Must be an absolute URL reachable while in AP mode
dhcp-option=114,http://192.168.4.1/.well-known/captive-portal

# (Optional) Domain handed to clients
domain=local
expand-hosts

# --- DNS hijack: send ALL DNS to the captive portal IP ---
# This is the key for iOS captive detection
address=/#/192.168.4.1

# Don't use /etc/resolv.conf (prevents “real” DNS leaking in AP mode)
no-resolv

# Provide a harmless upstream (unused because of address=/#/, but keeps dnsmasq happy)
server=1.1.1.1
server=8.8.8.8

# Logging (useful while debugging; you can remove later)
log-queries
log-dhcp
